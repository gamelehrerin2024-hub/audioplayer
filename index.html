<div id="GENIALLY_PRO_EDITOR" style="font-family: 'Segoe UI', system-ui, sans-serif; background: #121214; padding: 25px; border-radius: 20px; color: #fff; border: 1px solid #333; max-width: 500px; margin: auto;">
    <h2 style="text-align: center; color: #7ed6df; margin-bottom: 20px; font-weight: 300;">Audio Widget Constructor</h2>

    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
        <div style="grid-column: span 2;">
            <label style="font-size: 11px; color: #7ed6df; font-weight: bold;">GITHUB FOLDER URL:</label>
            <input type="text" id="gh_path" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #444; background: #000; color: #fff; margin-top: 5px; box-sizing: border-box;" value="https://github.com/gamelehrerin2024-hub/audioplayer/tree/main/audio">
        </div>

        <div>
            <label style="font-size: 11px; color: #7ed6df;">ACCENT COLOR:</label>
            <input type="color" id="accent" value="#7ed6df" style="width: 100%; height: 38px; border: none; cursor: pointer; background: transparent;">
        </div>

        <div>
            <label style="font-size: 11px; color: #7ed6df;">LANGUAGE:</label>
            <select id="lang" style="width: 100%; height: 38px; background: #000; color: #fff; border: 1px solid #444; border-radius: 6px;">
                <option value="EN">English</option>
                <option value="DE">Deutsch</option>
                <option value="RU">–†—É—Å—Å–∫–∏–π</option>
            </select>
        </div>

        <button onclick="buildFinalWidget()" style="grid-column: span 2; padding: 14px; background: #7ed6df; color: #000; border: none; border-radius: 8px; font-weight: 800; cursor: pointer; text-transform: uppercase; transition: 0.3s;">Generate Player Code</button>
    </div>

    <div id="res_section" style="display: none; margin-top: 20px; border-top: 1px solid #333; padding-top: 15px;">
        <label style="font-size: 11px; color: #7ed6df;">COPY & PASTE TO GENIALLY:</label>
        <textarea id="final_code" readonly style="width: 100%; height: 80px; background: #000; color: #00ffaa; font-family: monospace; font-size: 10px; border: 1px solid #444; padding: 10px; margin-top: 10px; box-sizing: border-box;"></textarea>
    </div>
</div>

<script>
function buildFinalWidget() {
    const url = document.getElementById('gh_path').value.trim();
    const clr = document.getElementById('accent').value;
    const lng = document.getElementById('lang').value;

    const parts = url.replace('https://github.com/', '').split('/');
    const user = parts[0], repo = parts[1], branch = parts[3], path = parts.slice(4).join('/');
    const api = `https://api.github.com/repos/${user}/${repo}/contents/${path}?ref=${branch}`;
    const raw = `https://raw.githubusercontent.com/${user}/${repo}/${branch}/${path}`;

    const playerHtml = `
<div style="width:350px; background:rgba(255,255,255,0.95); backdrop-filter:blur(10px); border-radius:24px; overflow:hidden; font-family:sans-serif; box-shadow:0 15px 35px rgba(0,0,0,0.15); border:1px solid #eee;">
    <div style="height:130px; background:linear-gradient(rgba(0,0,0,0.3),rgba(0,0,0,0.7)), url('${raw}/cover.jpg') center/cover, #2c3e50; display:flex; align-items:flex-end; padding:20px; position:relative;">
        <a id="dl" href="#" download style="position:absolute; top:15px; left:15px; background:rgba(255,255,255,0.2); width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; text-decoration:none; font-size:14px; backdrop-filter:blur(5px);">‚¨á</a>
        <div style="display:flex; align-items:center; gap:12px; color:#fff; z-index:2;">
            <div style="width:50px; height:50px; border-radius:12px; background:url('${raw}/cover.jpg') center/cover, #444; border:1px solid rgba(255,255,255,0.3);"></div>
            <div style="overflow:hidden;">
                <div id="ti" style="font-weight:bold; font-size:15px; width:200px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Loading...</div>
                <div style="font-size:10px; opacity:0.8; text-transform:uppercase;">${lng === 'RU' ? '–ü–ª–µ–π–ª–∏—Å—Ç' : lng === 'DE' ? 'Wiedergabeliste' : 'Playlist'}</div>
            </div>
        </div>
    </div>
    <div style="padding:15px; background:#fff;">
        <input type="range" id="sk" value="0" style="width:100%; accent-color:${clr}; height:4px; cursor:pointer; margin-bottom:10px;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div id="vc" style="position:relative; display:flex; align-items:center; width:20px;">
                <span style="cursor:pointer; font-size:16px;">üîä</span>
                <input type="range" id="vl" min="0" max="1" step="0.05" value="0.8" style="width:0; opacity:0; accent-color:${clr}; transition:0.3s; position:absolute; left:22px;">
            </div>
            <div style="display:flex; align-items:center; gap:12px;">
                <button onclick="window.goP()" style="background:none; border:none; font-size:22px; cursor:pointer;">‚èÆ</button>
                <button id="pb" onclick="window.goT()" style="background:#333; color:#fff; width:48px; height:48px; border-radius:50%; border:none; font-size:20px; cursor:pointer; display:flex; align-items:center; justify-content:center;">‚ñ∂</button>
                <button onclick="window.goN()" style="background:none; border:none; font-size:22px; cursor:pointer;">‚è≠</button>
            </div>
            <span id="sh" style="cursor:pointer; font-size:16px; color:#ccc;">üîÄ</span>
        </div>
    </div>
    <audio id="au"></audio>
</div>
<style>
#vc:hover #vl { width:60px; opacity:1; }
input[type=range] { -webkit-appearance:none; outline:none; background:#eee; border-radius:10px; }
</style>
<script>
(function(){
    const a=document.getElementById('au'), b=document.getElementById('pb'), s=document.getElementById('sk'), t=document.getElementById('ti'), v=document.getElementById('vl'), dl=document.getElementById('dl');
    let trks=[], cur=0, isS=false;
    fetch('${api}').then(r=>r.json()).then(data=>{
        trks=data.filter(f=>f.name.endsWith('.mp3')).map(f=>({n:f.name.replace('.mp3',''), u:f.download_url}));
        if(trks.length) l(0);
    });
    function l(i){ cur=i; a.src=trks[i].u; t.innerText=trks[i].n; dl.href=trks[i].u; a.load(); }
    window.goT=()=>{ if(a.paused){ a.play(); b.innerText='‚è∏'; } else { a.pause(); b.innerText='‚ñ∂'; } };
    window.goN=()=>{ cur=isS?Math.floor(Math.random()*trks.length):(cur+1)%trks.length; l(cur); a.play(); b.innerText='‚è∏'; };
    window.goP=()=>{ cur=(cur-1+trks.length)%trks.length; l(cur); a.play(); b.innerText='‚è∏'; };
    a.ontimeupdate=()=>{ s.value=(a.currentTime/a.duration)*100||0; };
    a.onended=()=>window.goN();
    s.oninput=()=>{ a.currentTime=(s.value/100)*a.duration; };
    v.oninput=()=>{ a.volume=v.value; };
    document.getElementById('sh').onclick=(e)=>{ isS=!isS; e.target.style.color=isS?'${clr}':'#ccc'; };
})();
<\/script>`;

    const final = `<iframe srcdoc='${playerHtml.replace(/'/g, "&apos;").replace(/<\/script>/g, '<\\/script>')}' width="380" height="340" style="border:none; background:transparent;" allow="autoplay"></iframe>`;
    document.getElementById('final_code').value = final;
    document.getElementById('res_section').style.display = 'block';
}
</script>
